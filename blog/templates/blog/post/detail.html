{% extends "blog/base.html" %}

{% load blog_tags %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}

<!-- post content ------------------------------------------------------->

<article class="mb-5 pb-1">

  <h1>{{ post.title }}</h1>

  <div class="mb-5 pb-4 border-bottom border-secondary">
    <span class="d-block mb-2 text-muted">
      <i class="bi-calendar-event mr-1"></i>
      Published {{ post.publish }} by {{ post.author }}
    </span>
    <a href="{% url 'blog:post_share' post.id %}" class="d-block mb-2">
      <i class="bi-share mr-1"></i> Share this post
    </a>
  </div>

  {{ post.body|markdown }}

</article>

<!-- similar posts section ---------------------------------------------->

<section class="mb-md-5">

  <h2 class="mb-4">Similar posts</h2>

  <!-- TODO: change this to an if statement to center "no posts" text -->
  <div class="row justify-content-center">
    {% for post in similar_posts|slice:":3" %}
    <div class="col-12 col-md-4 p-4 mb-5 mb-md-0">
      <a href="{{ post.get_absolute_url }}">
        <div class="card">
          <img src="{{ post.thumbnail.url }}" class="card-img-top p-4 thumbnail-image" alt="{{ post.title }}">
          <div class="card-body p-4">
            <h5 class="card-title">{{ post.title }}</h5>
            <p class="card-text font-size-sm">
              {{ post.body|truncatewords_html:125 }}
            </p>
          </div>
        </div>
      </a>
    </div>
    {% empty %}
    There are no similar posts yet.
    {% endfor %}
  </div>

</section>

<!-- comments section --------------------------------------------------->

<section>

  <!-- header -->
  {% with comments.count as total_comments %}
  <h2 class="mb-4 pb-4 border-bottom border-secondary">{{ total_comments }} comment{{ total_comments|pluralize }}</h2>
  {% endwith %}

  <!-- comments list -->
  {% for comment in comments %}
  <div class="my-4 pb-2 border-bottom border-secondary">
    <p class="text-muted">
      Comment {{ forloop.counter }} by <span class="text-primary">{{ comment.name }}</span><br />
      {{ comment.created }}
    </p>
    {{ comment.body|linebreaks }}
  </div>

  {% empty %}
  <p class="mb-5">There are no comments</p>

  {% endfor %}

  <!-- new comment form -->
  <div>{% include "./forms/comment_form.html" %}</div>

</section>

{% endblock %}